<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BleuTrk — Lattice-Waypoint Trail Ledger</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0a0c10;
      --surface: #12151c;
      --border: #1e2430;
      --muted: #6b7280;
      --text: #e2e8f0;
      --bleu: #3b82f6;
      --bleu-dim: #1e3a5f;
      --accent: #22d3ee;
      --sealed: #10b981;
      --radius: 8px;
      --font-sans: 'Syne', sans-serif;
      --font-mono: 'JetBrains Mono', monospace;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: var(--font-sans);
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
      background-image:
        linear-gradient(180deg, transparent 0%, var(--bg) 100%),
        radial-gradient(ellipse 80% 50% at 50% -20%, var(--bleu-dim) 0%, transparent 50%);
    }

    .wrap {
      max-width: 960px;
      margin: 0 auto;
      padding: 0 1.5rem;
    }

    /* ----- Hero ----- */
    header {
      padding: 4rem 0 3rem;
      text-align: center;
    }

    .logo {
      font-size: 2.5rem;
      font-weight: 800;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--bleu), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .tagline {
      font-size: 1.1rem;
      color: var(--muted);
      max-width: 36ch;
      margin: 0 auto 2rem;
    }

    .hero-cta {
      display: inline-flex;
      gap: 0.75rem;
      align-items: center;
      padding: 0.75rem 1.5rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text);
      text-decoration: none;
      font-weight: 600;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .hero-cta:hover {
      border-color: var(--bleu);
      box-shadow: 0 0 24px rgba(59, 130, 246, 0.15);
    }

    /* ----- Nav ----- */
    nav {
      padding: 1rem 0;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      background: rgba(10, 12, 16, 0.9);
      backdrop-filter: blur(8px);
      z-index: 10;
    }

    nav .wrap {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    nav a {
      color: var(--muted);
      text-decoration: none;
      font-size: 0.9rem;
      transition: color 0.2s;
    }

    nav a:hover {
      color: var(--bleu);
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 1.5rem;
    }

    /* ----- Sections ----- */
    section {
      padding: 3rem 0;
    }

    section h2 {
      font-size: 1.75rem;
      font-weight: 800;
      margin-bottom: 1rem;
      color: var(--text);
    }

    section p {
      color: var(--muted);
      margin-bottom: 1rem;
    }

    .concept-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .concept-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.25rem;
      transition: border-color 0.2s;
    }

    .concept-card:hover {
      border-color: var(--bleu-dim);
    }

    .concept-card h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--accent);
    }

    .concept-card p {
      font-size: 0.875rem;
      margin: 0;
      color: var(--muted);
    }

    /* ----- Demo ----- */
    .demo {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-top: 1.5rem;
    }

    .demo h3 {
      font-size: 1.1rem;
      margin-bottom: 1rem;
      color: var(--text);
    }

    .demo-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      margin-bottom: 1rem;
    }

    .demo-row:last-child {
      margin-bottom: 0;
    }

    button {
      font-family: var(--font-sans);
      font-weight: 600;
      padding: 0.5rem 1rem;
      background: var(--bleu);
      color: #fff;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      transition: opacity 0.2s, transform 0.1s;
    }

    button:hover {
      opacity: 0.9;
    }

    button:active {
      transform: scale(0.98);
    }

    button.secondary {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
    }

    button.secondary:hover {
      border-color: var(--bleu);
      color: var(--bleu);
    }

    .lattice-summary {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .summary-item {
      background: var(--bg);
      border-radius: var(--radius);
      padding: 0.75rem;
      font-size: 0.8rem;
    }

    .summary-item .label {
      color: var(--muted);
      display: block;
      margin-bottom: 0.25rem;
    }

    .summary-item .value {
      font-family: var(--font-mono);
      font-weight: 500;
      color: var(--text);
      word-break: break-all;
    }

    .segment-list {
      margin-top: 1rem;
      max-height: 280px;
      overflow-y: auto;
    }

    .segment-row {
      display: grid;
      grid-template-columns: 1fr 80px 80px 60px;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      font-size: 0.8rem;
      font-family: var(--font-mono);
      border-bottom: 1px solid var(--border);
      align-items: center;
    }

    .segment-row:last-child {
      border-bottom: none;
    }

    .segment-row.head {
      color: var(--muted);
      font-weight: 600;
      position: sticky;
      top: 0;
      background: var(--surface);
    }

    .segment-id {
      color: var(--accent);
      word-break: break-all;
    }

    .segment-sealed {
      color: var(--sealed);
      font-size: 0.75rem;
    }

    .trail-list {
      margin-top: 1rem;
    }

    .trail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.6rem 0.75rem;
      border-bottom: 1px solid var(--border);
      font-size: 0.85rem;
    }

    .trail-row:last-child {
      border-bottom: none;
    }

    .trail-id {
      font-family: var(--font-mono);
      color: var(--bleu);
    }

    .trail-meta {
      color: var(--muted);
      font-size: 0.8rem;
    }

    .epoch-list {
      margin-top: 1rem;
    }

    .epoch-row {
      padding: 0.6rem 0.75rem;
      border-bottom: 1px solid var(--border);
      font-size: 0.8rem;
      font-family: var(--font-mono);
    }

    .epoch-row:last-child {
      border-bottom: none;
    }

    .epoch-fp { color: var(--muted); word-break: break-all; font-size: 0.75rem; margin-top: 0.25rem; }

    .tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .tabs button {
      padding: 0.4rem 0.9rem;
      font-size: 0.85rem;
    }

    .tabs button.active {
      background: var(--bleu-dim);
      border: 1px solid var(--bleu);
    }

    .panel {
      display: none;
    }

    .panel.active {
      display: block;
    }

    .status {
      font-size: 0.85rem;
      color: var(--muted);
      margin-top: 0.75rem;
      padding: 0.5rem 0;
    }

    .status.connected {
      color: var(--sealed);
    }

    .status.error {
      color: #f87171;
    }

    .hash-vis {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 1rem;
      padding: 0.75rem;
      background: var(--bg);
      border-radius: var(--radius);
      word-break: break-all;
      line-height: 1.5;
    }

    footer {
      padding: 3rem 0;
      border-top: 1px solid var(--border);
      text-align: center;
      color: var(--muted);
      font-size: 0.875rem;
    }

    footer a {
      color: var(--bleu);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 640px) {
      .segment-row { grid-template-columns: 1fr 70px 70px 50px; font-size: 0.7rem; }
      .logo { font-size: 1.9rem; }
    }
  </style>
</head>
<body>
  <nav>
    <div class="wrap">
      <a href="#" class="logo">BleuTrk</a>
      <ul>
        <li><a href="#about">About</a></li>
        <li><a href="#concepts">Concepts</a></li>
        <li><a href="#demo">Demo</a></li>
      </ul>
    </div>
  </nav>

  <header>
    <div class="wrap">
      <h1 class="logo">BleuTrk</h1>
      <p class="tagline">Lattice-waypoint trail ledger for ordinal path proofs. Segments bound to chain and deploy context; no token, no claim.</p>
      <a href="#demo" class="hero-cta">Explore the lattice →</a>
    </div>
  </header>

  <section id="about">
    <div class="wrap">
      <h2>What is BleuTrk?</h2>
      <p>BleuTrk is an EVM contract that maintains an immutable ledger of segments—waypoints with values and ordinal order—organized into named trails and periodic epoch snapshots. Each segment is part of a hash chain for verification.</p>
      <p>Trailhead and relayer roles record segments; segments can be tagged, weighted, and grouped into trails. The lattice can be frozen after a delay. No token, no claim logic—just a durable, verifiable trail of data.</p>
    </div>
  </section>

  <section id="concepts">
    <div class="wrap">
      <h2>Concepts</h2>
      <p>Core ideas behind the contract.</p>
      <div class="concept-grid">
        <div class="concept-card">
          <h3>Segments</h3>
          <p>Units of the ledger: a segment id, value, block, ordinal index, and optional tag/weight. Recorded by trailhead or relayer.</p>
        </div>
        <div class="concept-card">
          <h3>Trails</h3>
          <p>Named groupings of segments. Create a trail, attach segments, then lock it. Each trail has segment count and total value.</p>
        </div>
        <div class="concept-card">
          <h3>Epochs</h3>
          <p>Periodic snapshots (e.g. every 64 segments): block, segment count, and a fingerprint hash for that point in time.</p>
        </div>
        <div class="concept-card">
          <h3>Chain hash</h3>
          <p>Each segment stores a hash linking to the previous segment, forming a chain. Enables off-chain verification of order and integrity.</p>
        </div>
      </div>
    </div>
  </section>

  <section id="demo">
    <div class="wrap">
      <h2>Lattice demo</h2>
      <p>Connect a wallet to read from a deployed BleuTrk contract, or use mock data to explore the UI.</p>

      <div class="demo">
        <div class="demo-row">
          <button type="button" id="btn-connect">Connect wallet</button>
          <button type="button" id="btn-mock" class="secondary">Load mock data</button>
          <span class="status" id="status">Not connected. Load mock data or connect wallet.</span>
        </div>

        <div class="tabs">
          <button type="button" data-tab="summary" class="active">Summary</button>
          <button type="button" data-tab="segments">Segments</button>
          <button type="button" data-tab="trails">Trails</button>
          <button type="button" data-tab="epochs">Epochs</button>
          <button type="button" data-tab="chain">Chain tip</button>
        </div>

        <div id="panel-summary" class="panel active">
          <h3>Lattice summary</h3>
          <div class="lattice-summary" id="lattice-summary">
            <div class="summary-item"><span class="label">Total segments</span><span class="value" id="s-total">—</span></div>
            <div class="summary-item"><span class="label">Sealed</span><span class="value" id="s-sealed">—</span></div>
            <div class="summary-item"><span class="label">Cumulative value</span><span class="value" id="s-cumulative">—</span></div>
            <div class="summary-item"><span class="label">Trails</span><span class="value" id="s-trails">—</span></div>
            <div class="summary-item"><span class="label">Epochs</span><span class="value" id="s-epochs">—</span></div>
            <div class="summary-item"><span class="label">Frozen</span><span class="value" id="s-frozen">—</span></div>
          </div>
        </div>

        <div id="panel-segments" class="panel">
          <h3>Recent segments</h3>
          <div class="segment-list">
            <div class="segment-row head">
              <span>Segment id</span>
              <span>Value</span>
              <span>Block</span>
              <span>Sealed</span>
            </div>
            <div id="segment-rows"></div>
          </div>
        </div>

        <div id="panel-trails" class="panel">
          <h3>Trails</h3>
          <div class="trail-list" id="trail-rows"></div>
        </div>

        <div id="panel-epochs" class="panel">
          <h3>Epoch snapshots</h3>
          <div class="epoch-list" id="epoch-rows"></div>
        </div>

        <div id="panel-chain" class="panel">
          <h3>Chain tip hash</h3>
          <p>Latest link in the segment hash chain.</p>
          <div class="hash-vis" id="chain-tip">—</div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="wrap">
      <p>BleuTrk — Lattice-waypoint trail ledger. EVM mainnet-safe; constructor-set roles, immutable config. No token, no claim.</p>
    </div>
  </footer>

  <script>
    (function () {
      const CONTRACT_ABI_SUMMARY = [
        'function totalSegments() view returns (uint256)',
        'function sealedCount() view returns (uint256)',
        'function getCumulativeValue() view returns (uint256)',
        'function trailCount() view returns (uint256)',
        'function currentEpochIndex() view returns (uint256)',
        'function latticeFrozen() view returns (bool)',
        'function getChainTipHash() view returns (bytes32)',
        'function getRecentSegmentIds(uint256 n) view returns (bytes32[])',
        'function getSegment(bytes32) view returns (uint256 value, uint256 recordedAtBlock, uint256 ordinalIndex, bool sealed)',
        'function getTrailIdByIndex(uint256) view returns (bytes32)',
        'function getTrail(bytes32) view returns (uint256 createdAtBlock, uint256 segmentCount, uint256 totalValue, bool locked)',
        'function getEpoch(uint256) view returns (uint256 atBlock, uint256 atSegmentCount, bytes32 fingerprint, uint256 sealedAtEpoch)'
      ];

      let provider = null, contractAddress = null, contract = null, currentAccount = null;

      const statusEl = document.getElementById('status');
      const latticeSummary = document.getElementById('lattice-summary');
      const segmentRows = document.getElementById('segment-rows');
      const trailRows = document.getElementById('trail-rows');
      const epochRows = document.getElementById('epoch-rows');
      const chainTipEl = document.getElementById('chain-tip');

      function setStatus(msg, isConnected, isError) {
        statusEl.textContent = msg;
        statusEl.classList.toggle('connected', isConnected);
        statusEl.classList.toggle('error', isError);
      }

      function shortHash(hash) {
        if (!hash || hash === '—') return '—';
        const s = typeof hash === 'string' ? hash : (hash.toString && hash.toString()) || String(hash);
        return s.slice(0, 10) + '…' + s.slice(-8);
      }

      function renderSummary(data) {
        document.getElementById('s-total').textContent = data.totalSegments ?? '—';
        document.getElementById('s-sealed').textContent = data.sealedCount ?? '—';
        document.getElementById('s-cumulative').textContent = data.cumulativeValue ?? '—';
        document.getElementById('s-trails').textContent = data.trails ?? '—';
        document.getElementById('s-epochs').textContent = data.epochs ?? '—';
        document.getElementById('s-frozen').textContent = data.frozen != null ? (data.frozen ? 'Yes' : 'No') : '—';
      }
